function procesa_apertura_caja(){fecha_doc=$("#fecha_doc").val(),fecha_con=$("#fecha_con").val(),fecha_ven=$("#fecha_ven").val(),moneda_caja=$("#moneda_caja").val(),cchica_aper=$("#cchica_aper").val(),medio_pago_doc=$("#medio_pago_doc").val(),monto=$("#monto_caja").val(),asignado_caja=$("#asignado_caja").val(),comentario_caja=$("#comentario_caja").val(),monto_cheque=$("#monto_cheque").val(),bandera=!0,""===fecha_doc&&(bandera=!1,alertify.error("Falta Fecha de Documento")),""===fecha_con&&(bandera=!1,alertify.error("Falta Fecha de Contabilidad")),""===fecha_ven&&(bandera=!1,alertify.error("Falta Fecha de Vencimiento")),""===moneda_caja&&(bandera=!1,alertify.error("Falta elegir Moneda de la Apertura")),""===cchica_aper&&(bandera=!1,alertify.error("Falta elegir Caja de la Apertura")),""===medio_pago_doc&&(bandera=!1,alertify.error("Falta elegir Medio de Pago de la Apertura")),""===monto&&(bandera=!1,alertify.error("Falta Monto")),monto<0&&(bandera=!1,alertify.error("Monto invalido")),""===asignado_caja&&(bandera=!1,alertify.error("Falta Asignado")),parseFloat(monto)<parseFloat(monto_cheque)&&(bandera=!1,alertify.error("Monto del Cheque Superior al monto ")),!0===bandera&&$.ajax({beforeSend:function(){},url:"registrar_apertura_caja_chica.php",type:"POST",data:"fecha_doc="+fecha_doc+"&fecha_con="+fecha_con+"&fecha_ven="+fecha_ven+"&moneda_caja="+moneda_caja+"&cchica_aper="+cchica_aper+"&medio_pago_doc="+medio_pago_doc+"&monto="+monto+"&asignado_caja="+asignado_caja+"&comentario_caja="+comentario_caja+"&monto_cheque="+monto_cheque,success:function(e){global=parseInt(e),0==global?alertify.error("No Inserto"):procesa_apertura_caja_cheque(global)},error:function(e,a,t){$("#errores").html("Error... "+a+"  "+t)}})}function listar_tipo_gasto(){$.ajax({beforeSend:function(){$("#gasto").html("Recuperando proveedores...")},url:"pone_tipo_gasto.php",type:"POST",data:null,success:function(e){$("#gasto").html(e),$(".select2").select2()},error:function(e,a,t){}})}function lista_impuesto(){$.ajax({beforeSend:function(){$("#lista_impuesto").html("Recuperando proveedores...")},url:"listar_impuesto_caja.php",type:"POST",data:null,success:function(e){$("#lista_impuesto").html(e),$(".select2").select2()},error:function(e,a,t){}})}function lista_impuesto2(){$.ajax({beforeSend:function(){$("#lista_impuesto2").html("Recuperando proveedores...")},url:"listar_impuesto_caja.php",type:"POST",data:null,success:function(e){$("#lista_impuesto2").html(e),$(".select2").select2()},error:function(e,a,t){}})}function lista_entregas_rendir(){$.ajax({beforeSend:function(){$("#lista_entregas_rendir").html("Recuperando Lista ...")},url:"consulta_listado_entregas_rendir.php",type:"POST",data:null,success:function(e){$("#lista_entregas_rendir").html(e),$("#tabla_cot").DataTable({order:[[1,"asc"]]})},error:function(e,a,t){}})}function lista_cuentas_cota(){$.ajax({beforeSend:function(){$("#cuenta_segmentada").html("Recuperando proveedores...")},url:"lista_cuentaCon_caja.php",type:"POST",data:null,success:function(e){$("#cuenta_segmentada").html(e),$(".select2").select2()},error:function(e,a,t){}})}function listar_proveedor_merc(){$.ajax({url:"lista_proveedores_caja_merc.php",type:"POST",data:null,success:function(e){$("#lista_proeevor_merc").html(e),$(".select2").select2()},error:function(e,a,t){}})}function registrar_documento(e){$("#modal_documento").modal("show"),lista_impuesto(),tipo_cambio_hoy(),listar_tipo_gasto(),lista_cuentas_cota();e=e.split("|");$("#saldoActual").html(Number(e[3]).toFixed(2)),setTimeout(()=>{cargarMontos(),$("#btn-migracion").hide(),$("#data_tser").hide(),$("#data_tcom").hide(),$("#data_tnum").hide()},500),cod_caja=e[2],cod_apertura=e[1],saldo=e[3],console.log(saldo),lista_documentos(cod_caja,cod_apertura),$(".nombreDocumento").html(""),$("#cod_caja").val(e[2]),$("#cod_apertura").val(e[1]),$("#saldo").html(Number(e[3]).toFixed(2)),$(".nombreDocumento").append("<span class='label label-warning'>Empleado: "+e[2]+"</span><span class='label label-warning'>-</span><span class='label label-warning'># Entrega: "+e[1]+"</span>")}function cargarMontos(){var a=0;$("#tabla_doc tbody tr").each(function(){var e=$(this).find("td:eq(18)").text(),e=parseFloat(e);$("#monto_regula").val(e),console.log(e),isNaN(e)||(a+=e,$("#montoCon").html(Number(a).toFixed(2)));e=$("#saldo").html(),e=parseFloat(e);isNaN(e)||(resta=e-a,$("#saldoActual").html(Number(resta).toFixed(2)))})}function monstrar_tipo(){tipo_documento=$("#tipo_documento").val(),"S"===tipo_documento?(console.log(tipo_documento),$("#lista_proeevor_doc").show(),$("#lista_proeevor_merc").hide(),$("#xd1").show(),$("#moneda_doc").select2().prop("disabled",!1),$("#moneda_pago").select2().prop("disabled",!1),$("#descripcion_servicio").val("").prop("disabled",!1),listar_proveedor_doc()):"M"===tipo_documento&&(console.log(tipo_documento),$("#lista_proeevor_doc").hide(),$("#lista_proeevor_merc").show(),listar_proveedor_merc(),$("#data_tser").hide(),$("#data_tnum").hide(),$("#moneda_doc").select2().prop("disabled",!0),$("#moneda_pago").select2().prop("disabled",!0),$("#descripcion_servicio").val("Mercaderia").prop("disabled",!0),$("#xd1").hide())}function tipo_cambio_hoy(){$.ajax({beforeSend:function(){$("#tc_hoy").html("Recuperando Lista ...")},url:"Consulta_TC_Comercial.php",type:"POST",data:null,success:function(e){$("#tc_hoy").html(e),tc=$("[name='tc_actual']").text().trim();var a=document.getElementById("tipo_cambio"),e=new Intl.NumberFormat("es-PE",{style:"currency",currency:"SOL"}).format(tc);a.innerText=e},error:function(e,a,t){}})}function lista_documentos(e,a){$.ajax({beforeSend:function(){$("#lista_documento").html("Recuperando documentos...")},url:"listar_documentos_entregaR.php",type:"POST",data:{cod_caja:e,cod_apertura:a},success:function(e){$("#lista_documento").html(e)},error:function(e,a,t){}})}function ultimo_valor_fila(){let e=[];return $("#tabla_doc > tbody > tr").each(function(){articulos=parseFloat($(this).find("td").eq(1).html()),e.push(articulos)}),e.sort(function(e,a){return e-a}),cantidad=e.length,data=1==isNaN(e[cantidad-1])?0:e[cantidad-1],data}function inserta_temporal_modificacion(){var e=$("#saldoActual").html(),a=parseFloat(e),t=$("#cantidad_documento").val(),o=$("#cod_caja").val(),r=$("#cod_apertura").val(),l=$("#fecha").val(),n=$("#moneda_doc").val(),c=$("#cantidad_documento").val(),s=$("#id_impuesto").val(),d=$("#cuenta_segmentada select").val();tipo_documento=$("#tipo_documento").val();var i,_,u,m,p,g,v,h,f=$("#tipo_documento").val(),b=$("#tipo_gasto").val(),C=$("#cuenta_segmentada select option:selected").text(),y=$("#tipo_documento option:selected").text();"S"===f?(i=$("#tipo_comprobante").val(),u=$("#serie_comprobante").val()+"-"+(_=$("#numero_comprobante").val()),data_cliente=$("#lista_proeevor_doc select").val(),data_cliente2=data_cliente.split("|"),p=data_cliente2[0],g=data_cliente2[1],v=data_cliente2[2],h=$("#descripcion_servicio").val(),m=0):(T=$("#tipo_documento_merc select").val(),id_cliente2=T.split("|"),i="01",u=id_cliente2[3]+"-"+(_=id_cliente2[4]),m=id_cliente2[0],data_cliente=$("#lista_proeevor_merc select").val(),data_cliente2=data_cliente.split("|"),p=data_cliente2[0],g=data_cliente2[1],v=data_cliente2[2],h="Mercaderia");var j=$("#moneda_pago").val(),e=$("#cantidad_pago").val();bandera=!0,fil=ultimo_valor_fila(),0===fil&&$("#tabla_doc > tbody > tr").remove();var T=ultimo_valor_fila()+1;""===p&&(bandera=!1,alertify.error("Falta Cod. Proveedor")),""===g&&(bandera=!1,alertify.error("Falta Nombre Proveedor")),""===v&&(bandera=!1,alertify.error("Falta Ruc Proveedor")),""===i&&(bandera=!1,alertify.error("Falta Elegir Tipo Comprobante")),""===u&&(bandera=!1,alertify.error("Falta Serie Comprobante")),""===_&&(bandera=!1,alertify.error("Falta Numero Comprobante")),""===n&&(bandera=!1,alertify.error("Falta Moneda Documento")),""===c&&(bandera=!1,alertify.error("Falta Monto Documento")),""===s&&(bandera=!1,alertify.error("Falta Elegir Impuesto")),""===d&&(bandera=!1,alertify.error("Falta Elegir Cuenta")),""===tipo_documento&&(bandera=!1,alertify.error("Falta Elegir Tipo Documento")),""===h&&(bandera=!1,alertify.error("Falta Descripcion Servicio")),""===j&&(bandera=!1,alertify.error("Falta Moneda Pago")),""===e&&(bandera=!1,alertify.error("Falta Cantidad Pago")),a<t&&(bandera=!1,alertify.error("Cantidad Documento no puede ser mayor que el Saldo")),""===f&&(bandera=!1,alertify.error("Falta Elegir Tipo Documento")),""===b&&(bandera=!1,alertify.error("Falta Elegir Tipo de Gasto")),!0===bandera&&($("#tabla_doc > tbody").append("<tr><td class='check' style='text-align: center;'><div class='form-check mb-2'><input class='form-check-input' name='procesar[]' type='checkbox' id='procesar'></div></td><td style='text-align: center;'>"+T+"</td><td style='text-align: center;display:none;'>"+o+"</td><td style='text-align: center;display:none;'>"+r+"</td><td style='text-align: center;display:none;'>"+p+"</td><td style='text-align: center;'>"+g+"</td><td style='text-align: center;'>"+v+"</td><td style='text-align: center;'>"+l+"</td><td style='text-align: center;display:none;'>"+i+"</td><td style='text-align: center;'>"+u+"</td><td style='text-align: center;display:none;'>"+_+"</td><td style='text-align: center;'>"+n+"</td><td style='text-align: center;'>"+parseFloat(c).toFixed(4)+"</td><td style='text-align: center;display:none;'>"+s+"</td><td style='text-align: center;display:none;'>"+C+"</td><td style='text-align: center;display:none;'>"+y+"</td><td style='text-align: center;display:none;'>"+h+"</td><td style='text-align: center;'>"+j+"</td><td style='text-align: center;'>"+parseFloat(e).toFixed(4)+"</td><td style='display:none;'>"+d+"</td><td style='display:none'>"+tipo_documento+"</td><td style='display:none'>S</td><td style='display:none'>0</td><td style='display:none'>0</td><td style='display:none'>0</td><td style='text-align: center;'><span class='label label-success'>"+m+"</span></td><td style='text-align: center;'><button class='btn  btn-danger btn-xs delete'><i class='icon-trash bigger-120'></i>X</button></td></tr>"),alertify.success("Insertado"),resumen(),cargarMontos(),limpiar_datos())}function limpiar_datos(){$("#lista_proeevor_doc select").val("").trigger("change"),$("#nombre_proveedor").val(""),$("#ruc_proveedor").val(""),$("#tipo_comprobante").val("").trigger("change"),$("#serie_comprobante").val(""),$("#numero_comprobante").val(""),$("#moneda_doc").val("").trigger("change"),$("#cantidad_documento").val(""),$("#id_impuesto").val("").trigger("change"),$("#cuenta_segmentada select").val("").trigger("change"),$("#tipo_documento").val("").trigger("change"),$("#descripcion_servicio").val(""),$("#moneda_pago").val("").trigger("change"),$("#cantidad_pago").val(""),$("#tipo_documento").val("").trigger("change"),$("#tipo_gasto").val("").trigger("change")}function procesa_migracion(){$('#tabla_doc input[type="checkbox"]:checked').each(function(e){codigo=$(this).closest("tr").children("td:eq(23)").text(),tipo=$(this).closest("tr").children("td:eq(24)").text(),empleado=$(this).closest("tr").children("td:eq(3)").text(),"S"===tipo&&$.ajax({beforeSend:function(){},url:"insertar_cola_service_factura.php",type:"POST",data:{docentry:codigo,tipo_doc:"14",objtype:"18"},success:function(e){},error:function(e,a,t){$("#errores").html("Error... "+a+"  "+t)}}),$.ajax({beforeSend:function(){},url:"insertar_cola_service_factura.php",type:"POST",data:{docentry:empleado,tipo_doc:"15",objtype:"24"},success:function(e){},error:function(e,a,t){$("#errores").html("Error... "+a+"  "+t)}})}),$("#modal_documento").modal("hide")}function actualizarFila(e){var a=e.closest("tr").find("#procesar:checked").length/2;e.is(":checked")?($("#btn-migracion").toggle(0<a),e.closest("tr").find("td").css("background-color","LightGreen")):(e.closest("tr").find("td").css("background-color","white"),$("#btn-migracion").toggle(0<a))}function procesa_modificacion(){$("#tabla_doc > tbody > tr").each(function(){linea=$(this).find("td").eq(1).html();var e=parseInt(linea),a=quitarAcentos($(this).find("td").eq(2).html()),t=quitarAcentos($(this).find("td").eq(3).html()),o=quitarAcentos($(this).find("td").eq(4).html()),r=quitarAcentos($(this).find("td").eq(5).html()),l=$(this).find("td").eq(6).html(),n=$(this).find("td").eq(7).html(),c=$(this).find("td").eq(8).html();serie=$(this).find("td").eq(9).html(),serie2=serie.split("-");var s=serie2[0],d=serie2[1],i=$(this).find("td").eq(11).html(),_=$(this).find("td").eq(12).html(),u=$(this).find("td").eq(13).html(),m=$(this).find("td").eq(18).html(),p=$(this).find("td").eq(19).html(),g=$(this).find("td").eq(16).html(),v=$(this).find("td").eq(17).html(),h=$(this).find("td").eq(18).html(),f=$(this).find("td").eq(25).children().html(),b=$(this).find("td").eq(20).html();docentry=1,$.ajax({beforeSend:function(){},url:"procesa_documento_entrega_rendir.php",type:"POST",data:"cod_caja="+a+"&cod_apertura="+t+"&line="+e+"&codigo_proveedor="+o+"&proveedor="+r+"&ruc="+l+"&fecha_documento="+n+"&tipo_comprobante="+c+"&serie_comprobante="+s+"&numero_comprobante="+d+"&moneda_documento="+i+"&monto_documento="+_+"&impuesto_documento="+u+"&tipo_documento="+p+"&cuenta="+m+"&servicio_descripcion="+g+"&moneda_pago="+v+"&monto_pagado="+h+"&docentry="+docentry+"&nro_sap="+f+"&tipo="+b,success:function(e){$("#modal_documento").modal("hide"),cargarMontos()},error:function(e,a,t){$("#errores").html("Error... "+a+"  "+t)}})})}function resumen(){var e=0;$("#tabla_doc > tbody > tr").each(function(){e=parseFloat(parseFloat(e)+parseFloat($(this).find("td").eq(11).html())).toFixed(2)}),cmoneda=$("#moneda_doc option:selected").val();var a=document.getElementById("saldo").innerText;nuevo_saldo=parseFloat(a-e).toFixed(2),$("#totales").html(nuevo_saldo),0<e?($("#btn-procesa").prop("disabled",!1),$("#btn-cancela").prop("disabled",!1),$("#btn-cancel").prop("disabled",!1)):$("#btn-cancela").prop("disabled",!0)}function quitarAcentos(e){var a={"á":"a","é":"e","í":"i","ó":"o","ú":"u","Á":"A","É":"E","Í":"I","Ó":"O","Ú":"U","Ñ":"N","ñ":"n","ç":"c","Ç":"C","à":"a","è":"e","ì":"i","ò":"o","ù":"u","À":"A","È":"E","Ì":"I","Ò":"O","Ù":"U"};return e.split("").map(e=>a[e]||e).join("").toString()}function genera_pdf_apertura(e,a){window.open("pdf_entregas_rendir.php?cod_apertura="+e+"&caja_chica="+a)}function cerrar_apertura_caja(e){console.log(e),$("#modal_cerrar_apertura").modal("show");e=e.split("|");doc_caja=e[0],cod_caja=e[2],cod_apertura=e[1],monto_apertura=e[3],monto_saldo=e[4],monto_consumo=e[5],moneda=e[6],asignado=e[7],fecha=e[8],monto_entrega=e[9],$("#cod_caja_liq").val(cod_caja),$("#docentry_apertura").val(doc_caja),$("#cod_apertura_liq").val(cod_apertura),$("#monto_apertura_liq").val(Number(monto_apertura).toFixed(2)),$("#moneda_liq").val(moneda),$("#monto_consumo_liq").val(Number(monto_saldo).toFixed(2)),$("#monto_saldo_liq").val(Number(monto_consumo).toFixed(2)),$(".nuticket_lig").html(""),$("#fechaper_liq").val(fecha),$("#asignado_liq").val(asignado),$("#monto_entrega_liq").val(monto_entrega),$(".nuticket_lig").append("Liquidar Caja | <span class='label label-warning'>Empleado: "+e[2]+" - Entrega: "+e[1]+"</span>"),$.ajax({beforeSend:function(){$("#lista_entrega_efec3").html("Recuperando Lista ...")},url:"consulta_listado_cchica_apertura_entrega2.php",type:"POST",data:{cod_caja:cod_caja,cod_apertura:cod_apertura},success:function(e){$("#lista_entrega_efec3").html(e),$("#tabla_entrega3").DataTable({order:[[1,"asc"]]})},error:function(e,a,t){}})}function procesa_cierre_aper(){cod_caja=$("#cod_caja_liq").val(),cod_apertura=$("#cod_apertura_liq").val(),docentry_apertura=$("#docentry_apertura").val(),swal({title:"Desea Liquidar Caja?",icon:"warning",buttons:["No","Si, Liquidar Caja"],dangerMode:!0,closeOnConfirm:!0,closeOnEsc:!1,closeOnClickOutside:!1}).then(e=>{e?(swal("Procesando ",{icon:"success",timer:3e3,closeOnEsc:!1,buttons:!1,closeOnClickOutside:!1}),$.post("procesa_liquidar_entrega_rendir.php",{cod_caja:cod_caja,cod_apertura:cod_apertura},function(e){$.ajax({beforeSend:function(){},url:"insertar_cola_service_factura.php",type:"POST",data:{docentry:docentry_apertura,tipo_doc:"16",objtype:"18"},success:function(e){},error:function(e,a,t){$("#errores").html("Error... "+a+"  "+t)}}),$("#modal_cerrar_apertura").modal("hide"),lista_apertura_caja_chica()})):swal("No se pudo registrar")})}function busca_detalle_apertura(e,a){$("#modal_detalle_apertura").modal("show"),$.ajax({beforeSend:function(){$("#lista_documento_det").html("Recuperando documentos...")},url:"listar_documentos_entregaR2.php",type:"POST",data:{cod_caja:a,cod_apertura:e},success:function(e){$("#lista_documento_det").html(e),$("#tabla_doc_detalle").DataTable({order:[[1,"asc"]]})},error:function(e,a,t){}})}function ver_eventos(e,a){$("#modal_eventos_cc").modal("show"),$.ajax({beforeSend:function(){$("#lista_eventos_cc").html("Recuperando documentos...")},url:"listar_eventos_entrega_rendir.php",type:"POST",data:{cod_caja:a,cod_apertura:e},success:function(e){$("#lista_eventos_cc").html(e),$("#tabla_eventos_cc").DataTable({order:[[1,"asc"]]})},error:function(e,a,t){}})}function entregar_efectivo(e){$("#modal_entregar_efectivo").modal("show");e=e.split("|");cod_caja=e[2],cod_apertura=e[1],monto_apertura=e[3],monto_saldo=e[5],monto_consumo=e[4],moneda=e[6],$(".nuticket").html(""),$(".nuticket").append("Entrega Efectivo | <span class='label label-warning'>Caja: "+e[2]+" - Apertura: "+e[1]+"</span>"),$("#moneda_efec").val(moneda),$("#cc_efec").val(cod_caja),$("#cca_efec").val(cod_apertura),$("#montaper_efec").val(monto_apertura),listar_tabla_entrega(cod_caja,cod_apertura)}function listar_tabla_entrega(e,a){$.ajax({beforeSend:function(){$("#lista_clista_entrega_efecajas").html("Recuperando Lista ...")},url:"consulta_listado_cchica_apertura_entrega.php",type:"POST",data:{cod_caja:e,cod_apertura:a},success:function(e){$("#lista_entrega_efec").html(e),$("#tabla_entrega").DataTable({order:[[0,"asc"]]})},error:function(e,a,t){}})}function procesa_entrega_efectivo(){asignado_efec=$("#asignado_efec").val(),monto_efec=$("#monto_efec").val(),motivo_efec=$("#motivo_efec").val(),bandera=!0,moneda_efec=$("#moneda_efec").val(),montaper_efec=parseFloat($("#montaper_efec").val()),cod_caja=$("#cc_efec").val(),cod_apertura=$("#cca_efec").val(),""===asignado_efec?($(".dato1").removeClass("has-success"),$(".dato1").addClass("has-error"),$(".dato_1").removeClass("valido"),$(".dato_1").addClass("novalido"),$(".dato_1").removeClass("fa-check"),$(".dato_1").addClass("fa-times"),$(".dato_1").removeClass("disabledTab"),$(".dato_1").addClass("activeTab"),$("#mesagge").removeClass("disabledTab"),$("#mesagge").addClass("activeTab"),$("#mesagge").html("Falta Asignado"),bandera=!1):($(".dato1").removeClass("has-error"),$(".dato1").addClass("has-success"),$(".dato_1").removeClass("novalido"),$(".dato_1").addClass("valido"),$(".dato_1").removeClass("fa-times"),$(".dato_1").addClass("fa-check"),$("#mesagge").removeClass("activeTab"),$("#mesagge").addClass("disabledTab"),$("#mesagge").html(""),$(".dato_1").removeClass("disabledTab"),$(".dato_1").addClass("activeTab")),""===monto_efec||monto_efec<=0||monto_efec>montaper_efec?($(".dato2").removeClass("has-success"),$(".dato2").addClass("has-error"),$(".dato_2").removeClass("valido"),$(".dato_2").addClass("novalido"),$(".dato_2").removeClass("fa-check"),$(".dato_2").addClass("fa-times"),$(".dato_2").removeClass("disabledTab"),$(".dato_2").addClass("activeTab"),$("#mesagge2").removeClass("disabledTab"),$("#mesagge2").addClass("activeTab"),""===monto_efec&&$("#mesagge2").html("Falta Invalido"),monto_efec<=0&&$("#mesagge2").html("Monto Invalido"),monto_efec>montaper_efec&&$("#mesagge2").html("Monto superior a la Apertura"),bandera=!1):($(".dato2").removeClass("has-error"),$(".dato2").addClass("has-success"),$(".dato_2").removeClass("novalido"),$(".dato_2").addClass("valido"),$(".dato_2").removeClass("fa-times"),$(".dato_2").addClass("fa-check"),$("#mesagge2").removeClass("activeTab"),$("#mesagge2").addClass("disabledTab"),$("#mesagge2").html(""),$(".dato_2").removeClass("disabledTab"),$(".dato_2").addClass("activeTab")),""===motivo_efec?($(".dato3").removeClass("has-success"),$(".dato3").addClass("has-error"),$(".dato_3").removeClass("valido"),$(".dato_3").addClass("novalido"),$(".dato_3").removeClass("fa-check"),$(".dato_3").addClass("fa-times"),$(".dato_3").removeClass("disabledTab"),$(".dato_3").addClass("activeTab"),$("#mesagge3").removeClass("disabledTab"),$("#mesagge3").addClass("activeTab"),$("#mesagge3").html("Falta Motivo"),bandera=!1):($(".dato3").removeClass("has-error"),$(".dato3").addClass("has-success"),$(".dato_3").removeClass("novalido"),$(".dato_3").addClass("valido"),$(".dato_3").removeClass("fa-times"),$(".dato_3").addClass("fa-check"),$("#mesagge3").removeClass("activeTab"),$("#mesagge3").addClass("disabledTab"),$("#mesagge3").html(""),$(".dato_3").removeClass("disabledTab"),$(".dato_3").addClass("activeTab")),!0===bandera&&$.ajax({beforeSend:function(){},url:"registrar_apertura_caja_chica_entrega.php",type:"POST",data:"asignado_efec="+asignado_efec+"&monto_efec="+monto_efec+"&motivo_efec="+motivo_efec+"&moneda_efec="+moneda_efec+"&cod_caja="+cod_caja+"&cod_apertura="+cod_apertura,success:function(e){global=parseInt(e),0==global?alertify.error("No Inserto"):swal("Insertando!","Se agrego la entrega!","success"),listar_tabla_entrega(cod_caja,cod_apertura),limpiar_entrega_efec()},error:function(e,a,t){$("#errores").html("Error... "+a+"  "+t)}})}function resumen_regularizar(){var a=0;$('#tabla_entrega2 input[type="checkbox"]:checked').each(function(e){$(this).prop("checked")&&(a+=parseFloat($(this).closest("tr").children("td:eq(4)").text()))}),$("#monto_regula").val(parseFloat(a).toFixed(2))}function gestionarMontoRegula(){var e,a=$("#montoCon_regula").val();0<a.length&&(e=$("#monto_regula").val(),e=parseFloat(e),parseFloat(a)>e&&alertify.error("El valor ingresado no puede ser mayor que "+e),a=(e-parseFloat(a)).toFixed(2),$("#montoDev_regula").val(a))}function listar_tabla_entrega2(){$.ajax({beforeSend:function(){$("#lista_entrega_efec2").html("Recuperando Lista ...")},url:"consulta_listado_cchica_apertura_entrega2.php",type:"POST",data:{cod_caja:cod_caja,cod_apertura:cod_apertura},success:function(e){$("#lista_entrega_efec2").html(e),$("#tabla_entrega2").DataTable({order:[[1,"asc"]]})},error:function(e,a,t){}})}function limpiar_entrega_efec(){$("#asignado_efec").val(""),$("#monto_efec").val(""),$("#motivo_efec").val(""),$(".dato1").removeClass("has-error"),$(".dato1").removeClass("has-success"),$(".dato_1").removeClass("novalido"),$(".dato_1").removeClass("valido"),$(".dato_1").removeClass("fa-times"),$(".dato_1").removeClass("fa-check"),$("#mesagge").removeClass("activeTab"),$("#mesagge").addClass("disabledTab"),$("#mesagge").html(""),$(".dato_1").removeClass("activeTab"),$(".dato_1").addClass("disabledTab"),$(".dato2").removeClass("has-error"),$(".dato2").removeClass("has-success"),$(".dato_2").removeClass("novalido"),$(".dato_2").removeClass("valido"),$(".dato_2").removeClass("fa-times"),$(".dato_2").removeClass("fa-check"),$("#mesagge2").removeClass("activeTab"),$("#mesagge2").addClass("disabledTab"),$("#mesagge2").html(""),$(".dato_2").removeClass("activeTab"),$(".dato_2").addClass("disabledTab"),$(".dato3").removeClass("has-error"),$(".dato3").removeClass("has-success"),$(".dato_3").removeClass("novalido"),$(".dato_3").removeClass("valido"),$(".dato_3").removeClass("fa-times"),$(".dato_3").removeClass("fa-check"),$("#mesagge3").removeClass("activeTab"),$("#mesagge3").addClass("disabledTab"),$("#mesagge3").html(""),$(".dato_3").removeClass("activeTab"),$(".dato_3").addClass("disabledTab")}function darbaja_entregaefec(e){e=e.split("|");cod_caja=e[1],cod_apertura=e[2],id_entrega=e[4],swal("Describa el motivo:",{content:"input"}).then(e=>{$.ajax({beforeSend:function(){},url:"registrar_baja_caja_chica_entrega.php",type:"POST",data:"id_entrega="+id_entrega+"&motivo="+e,success:function(e){swal("Eliminando!","Se elimino!","success"),listar_tabla_entrega(cod_caja,cod_apertura)},error:function(e,a,t){$("#errores").html("Error... "+a+"  "+t)}})})}function regularizar_entrega(e){$("#modal_regularizar").modal("show");e=e.split("|");cod_caja=e[2],cod_apertura=e[1],monto_apertura=e[3],monto_saldo=e[5],monto_consumo=e[4],moneda=e[6],$("#cc_regula").val(e[2]),$("#ca_regula").val(e[1]),$(".nuticket_regu").html(""),$(".nuticket_regu").append("Regularizar | <span class='label label-warning'>Caja: "+e[2]+" - Apertura: "+e[1]+"</span>"),listar_tabla_entrega2(cod_caja,cod_apertura),listar_proveedor_regularizar(),lista_impuesto2()}function procesa_regularizacion(){monto_regula=""!=$("#monto_regula").val()?$("#monto_regula").val():0,d=""!=$("#montoCon_regula").val()?$("#montoCon_regula").val():0,montoDev_regula=""!=$("#montoDev_regula").val()?$("#montoDev_regula").val():0,tc_regula=$("#tc_regula option:selected").val(),serie_regula=$("#serie_regula").val(),numero_regula=$("#numero_regula").val(),nuevo_monto=parseFloat(parseFloat(d)+parseFloat(montoDev_regula));var e,a,t,o,r,l,n,c,s,d,i,_,u,m=(m=$("#lista_proeevor_regu select").val()).split("|"),t=m[0],o=m[1],r=m[2],l=$("#fecha_regula").val();bandera=!0,i=$("#lista_impuesto2 select").val(),_=$("#cuenta_segmentada_regu").val(),u=$("#servicio_regula").val(),""===monto_regula||monto_regula<=0?(validacion_regu(1,!0),""===monto_regula&&$("#mesagge_regu1").html("*Falta Monto"),monto_regula<=0&&(mensahe=$("#mesagge_regu").html("*Falta Monto"),$("#mesagge_regu1").html("*Monto Invalido")),bandera=!1):validacion_regu(1,!1),""===d||d<=0?(validacion_regu(2,!0),""===d&&$("#mesagge_regu2").html("*Falta Monto"),d<=0&&(mensahe=$("#mesagge_regu2").html("*Falta Monto"),$("#mesagge_regu2").html("*Monto Invalido")),bandera=!1):validacion_regu(2,!1),""===montoDev_regula||montoDev_regula<0?(validacion_regu(3,!0),""===montoDev_regula&&$("#mesagge_regu3").html("*Falta Monto"),montoDev_regula<0&&(mensahe=$("#mesagge_regu3").html("*Falta Monto"),$("#mesagge_regu3").html("*Monto Invalido")),bandera=!1):validacion_regu(3,!1),""===tc_regula?(validacion_regu(4,!0),""===tc_regula&&$("#mesagge_regu4").html("*Falta Tipo de Comprobante"),bandera=!1):validacion_regu(4,!1),""===serie_regula?(validacion_regu(5,!0),""===tc_regula&&$("#mesagge_regu5").html("*Falta Serie"),bandera=!1):validacion_regu(5,!1),""===numero_regula?(validacion_regu(6,!0),""===tc_regula&&$("#mesagge_regu6").html("*Falta Serie"),bandera=!1):validacion_regu(6,!1),parseFloat(nuevo_monto)>parseFloat(monto_regula)&&(alertify.error("Monto Superior al de Regularizar"),validacion_regu(1,!(bandera=!1)),validacion_regu(2,!0),validacion_regu(3,!0));let p=[];$('#tabla_entrega2 input[type="checkbox"]:checked').each(function(e){docentry=$(this).closest("tr").children("td:eq(1)").text(),p.push(docentry)}),1==bandera&&(e=quitarAcentos($("#cc_regula").val()),a=quitarAcentos($("#ca_regula").val()),t=quitarAcentos(t),o=quitarAcentos(o),n=tc_regula,c=serie_regula,s=numero_regula,u=quitarAcentos(u),m=i,docentry=p.toString(),line=0,$.post("procesa_documento_caja_entrega.php",{cod_caja:e,cod_apertura:a,line:line,codigo_proveedor:t,proveedor:o,ruc:r,fecha_documento:l,tipo_comprobante:n,serie_comprobante:c,numero_comprobante:s,moneda_documento:"SOL",montoCon_regula:d,impuesto_documento:i,tipo_documento:"S",cuenta:_,servicio_descripcion:u,moneda_pago:"SOL",monto_pagado:m,docentry:docentry,montoDev_regula:montoDev_regula,monto_regula:monto_regula},function(e){$("#modal_regularizar").modal("hide"),limpiar_regula(),Swal.fire({icon:"success",title:"Entrega Regularizada",text:"La entrega fue regularizada.",showConfirmButton:!1,timer:2e3}).then(function(){})}))}function validacion_regu(e,a){!0===a?($(".regu"+e).removeClass("has-success"),$(".regu"+e).addClass("has-error"),$(".regu_"+e).removeClass("valido"),$(".regu_"+e).addClass("novalido"),$(".regu_"+e).removeClass("fa-check"),$(".regu_"+e).addClass("fa-times"),$(".regu_"+e).removeClass("disabledTab"),$(".regu_"+e).addClass("activeTab"),$("#mesagge_regu"+e).removeClass("disabledTab"),$("#mesagge_regu"+e).addClass("activeTab")):($(".regu"+e).removeClass("has-error"),$(".regu"+e).addClass("has-success"),$(".regu_"+e).removeClass("novalido"),$(".regu_"+e).addClass("valido"),$(".regu_"+e).removeClass("fa-times"),$(".regu_"+e).addClass("fa-check"),$("#mesagge_regu"+e).removeClass("activeTab"),$("#mesagge_regu"+e).addClass("disabledTab"),$("#mesagge_regu"+e).html(""),$(".regu_"+e).removeClass("disabledTab"),$(".regu_"+e).addClass("activeTab"))}function tipo_comprobante_doc(){tc_regula=$("#tipo_comprobante option:selected").val(),"00"===tc_regula&&($("#serie_comprobante").val("-"),$("#numero_comprobante").val("-"))}function tipo_comprobante_regula(){tc_regula=$("#tc_regula option:selected").val(),"00"===tc_regula&&($("#serie_regula").val("-"),$("#numero_regula").val("-"))}function listar_proveedor_regularizar(){$.ajax({url:"lista_proveedores_caja.php",type:"POST",data:null,success:function(e){$("#lista_proeevor_regu").html(e),$(".select2").select2()},error:function(e,a,t){}})}function listar_proveedor_doc(){$.ajax({url:"lista_proveedores_caja.php",type:"POST",data:null,success:function(e){$("#lista_proeevor_doc").html(e),$(".select2").select2()},error:function(e,a,t){}})}function listar_sericeCompro_merc(e,a){$.ajax({url:"lista_serie_caja_merc.php",type:"POST",data:{cardcode:e,valor:a},success:function(e){$("#tipo_serie_merc").html(e),$(".select2").select2()},error:function(e,a,t){}})}function listar_numeroCompro_merc(e,a,t){$.ajax({url:"lista_numero_caja_merc.php",type:"POST",data:{cardcode:e,tipo_cp:a,valor:t},success:function(e){$("#tipo_numero_merc").html(e),$(".select2").select2()},error:function(e,a,t){}})}function listar_comprobante_merc(e){$.ajax({url:"lista_comprobantes_caja_merc.php",type:"POST",data:{cardcode:e},success:function(e){$("#tipo_documento_merc").html(e),$(".select2").select2()},error:function(e,a,t){}})}function limpiar_regula(){$("#lista_proeevor_regu select").val("").trigger("change"),$("#lista_impuesto2 select").val("").trigger("change"),$("#cuenta_segmentada_regu").val("").trigger("change"),$("#tc_regula").val("").trigger("change"),$("#serie_regula").val(""),$("#numero_regula").val(""),$("#monto_regula").val("0"),$("#montoCon_regula").val("0"),$("#montoDev_regula").val("0"),$("#servicio_regula").val("0"),limpiar_regula2(1),limpiar_regula2(2),limpiar_regula2(3),limpiar_regula2(4),limpiar_regula2(6),limpiar_regula2(7),limpiar_regula2(8),limpiar_regula2(9),limpiar_regula2(10),limpiar_regula2(11),limpiar_regula2(12),limpiar_regula2(13)}function limpiar_regula2(e){$(".regu"+e).removeClass("has-error"),$(".regu"+e).removeClass("has-success"),$(".regu_"+e).removeClass("novalido"),$(".regu_"+e).removeClass("valido"),$(".regu_"+e).removeClass("fa-times"),$(".regu_"+e).removeClass("fa-check"),$("#mesagge_regu"+e).removeClass("activeTab"),$("#mesagge_regu"+e).addClass("disabledTab"),$("#mesagge_regu"+e).html(""),$(".regu_"+e).removeClass("activeTab"),$(".regu_"+e).addClass("disabledTab")}function importar_excel(){var e=document.getElementById("miElementoCheckbox");e.checked?($(".excel").removeClass("disabledTab"),$(".excel").addClass("activeTab")):($(".excel").removeClass("activeTab"),$(".excel").addClass("disabledTab")),e.addEventListener("click",function(){e.checked?($(".excel").removeClass("disabledTab"),$(".excel").addClass("activeTab")):($(".excel").removeClass("activeTab"),$(".excel").addClass("disabledTab"))})}function abrir_modal_doc(){listar_docs_entregas(),$("#modal_doc").modal("show"),$("#detalle_pagos_realizados").hide()}function listar_docs_entregas(){$.ajax({beforeSend:function(){$("#lista_docs_entregas").html("Recuperando Lista ...")},url:"consulta_listado_entregas_rendir_resumen.php",type:"POST",data:null,success:function(e){$("#lista_docs_entregas").html(e),$("#tabla_cot").DataTable().destroy(),$("#tabla_cot").DataTable({order:[[1,"asc"]],columnDefs:[{targets:[2],visible:!1,searchable:!1}]})},error:function(e,a,t){}})}function mostrar_det_pagos_realizados(e,a){$("#detalle_pagos_realizados").show(),$.ajax({url:"listar_documentos_entregaR_modal.php",type:"POST",data:{cod_caja:e,cod_apertura:a},success:function(e){$("#detalle_pagos_realizados").html(e),$("#tabla_of_va").DataTable({})},error:function(e,a,t){}})}function mostrar_modal_asiento(e){$("#modal_asiento").modal("show"),$(".nombreAsiento").html(""),$(".nombreAsiento").append("<span class='label label-warning'>Asiento Contable SAP: "+e+"</span>"),$.ajax({beforeSend:function(){$("#lista_docs_asiento").html("Recuperando Lista ...")},url:"consulta_listado_entregas_asiento.php",type:"POST",data:{transid:e},success:function(e){$("#lista_docs_asiento").html(e),$("#tabla_asiento").DataTable().destroy(),$("#tabla_asiento").DataTable({order:[[1,"asc"]],columnDefs:[{targets:[2],visible:!1,searchable:!1}]})},error:function(e,a,t){}})}$(document).on("keyup","#cantidad_documento",function(){var e,a=$(this).val();0<a.length&&(e=$("#saldoActual").html(),e=parseFloat(e),parseFloat(a)>e&&alertify.error("El valor ingresado no puede ser mayor que "+e),valorTD=(e-a).toFixed(2),$("#totales").html(Number(valorTD).toFixed(2)),$("#totalDoc").html(Number(a).toFixed(2)),$("#cantidad_pago").val(a))}),$(document).on("click","#tabla_doc tr",function(e){e.stopPropagation();e=$(this).find("#procesar");e.prop("disabled")||(e.prop("checked")?e.prop("checked",!1):e.prop("checked",!0),actualizarFila(e))}),$(document).on("click","#procesar",function(e){e.stopPropagation(),actualizarFila($(this))}),$(function(){$(document).on("click",".delete",function(){var e=$(this).parents().parents().get(0);$(e).remove(),resumen(),num_filas=document.getElementById("tabla_articulos").rows.length-1,num_filas<=0?$("#cpago").prop("disabled",""):$("#cpago").prop("disabled","disabled")})}),$(document).on("click","#entrega_mod",function(){det=document.querySelectorAll("#entrega_mod:checked").length,$(this).is(":checked")?($(this).parents("tr").find("td").css("background-color","LightGreen"),0<det?(resumen_regularizar(),gestionarMontoRegula()):$("#monto_regula").val(0)):($(this).parents("tr").find("td").css("background-color","white"),0<det?(resumen_regularizar(),gestionarMontoRegula()):($("#monto_regula").val(0),$("#montoCon_regula").val(""),$("#montoDev_regula").val("")))}),$(document).on("keyup","#montoCon_regula",gestionarMontoRegula),$(document).on("keyup","#montoDev_regula",function(){var e=$(this).val();0<e.length&&(montoRegula=$("#monto_regula").val(),montoRegula=parseFloat(montoRegula),parseFloat(e)>montoRegula&&alertify.error("El valor ingresado no puede ser mayor que "+montoRegula))}),$(document).on("change","#lista_proeevor_regu select",function(){var e=this.value.split("|");$("#cliente_regula").val(e[1]),$("#ruc_regula").val(e[2])}),$(document).on("change","#lista_proeevor_doc select",function(){var e=this.value.split("|");$("#nombre_proveedor").val(e[1]),$("#ruc_proveedor").val(e[2]),$("#data_tcom").show(),$("#data_tcom_merc").hide(),$("#data_tser").show(),$("#data_tser_merc").hide(),$("#data_tnum").show(),$("#data_tnum_merc").hide()}),$(document).on("change","#lista_proeevor_merc select",function(){var e=this.value.split("|");$("#nombre_proveedor").val(e[1]),$("#ruc_proveedor").val(e[2]),$("#data_tcom").hide(),$("#data_tcom_merc").show(),$("#data_tser").hide(),$("#data_tser_merc").show(),$("#data_tnum").hide(),$("#data_tnum_merc").show(),listar_comprobante_merc(e[0])}),$(document).on("change","#tipo_documento_merc select",function(){var e=this.value;id_cliente2=e.split("|"),$("#cantidad_documento").val(id_cliente2[2]),$("#cantidad_pago").val(id_cliente2[2]),$("#lista_impuesto select").val(id_cliente2[1]).trigger("change"),$("#id_impuesto").select2().prop("disabled",!0)}),$(document).on("change","#tipo_serie_merc select",function(){var e=this.value;id_cliente2=e.split("|"),$("#cantidad_documento").val(id_cliente2[2]),$("#cantidad_pago").val(id_cliente2[2]),$("#lista_impuesto select").val(id_cliente2[1]).trigger("change")}),$(document).on("change","#tipo_numero_merc select",function(){var e=this.value;id_cliente2=e.split("|"),$("#cantidad_documento").val(id_cliente2[2]),$("#cantidad_pago").val(id_cliente2[2]),$("#lista_impuesto select").val(id_cliente2[1]).trigger("change")}),$(document).on("click","#tabla_consulta tbody tr",function(){$(this).find("td").css("background-color","LightGreen");var e=$(this).closest("tr").find("td:eq(2)").text();mostrar_det_pagos_realizados($(this).closest("tr").find("td:eq(3)").text(),e)});
